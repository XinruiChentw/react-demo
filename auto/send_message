#!/usr/bin/env bash
set -e

message_to_send() {
  SHORT_SHA=`echo $commit | cut -c1-8`
  cat <<EOF
{
    "msgtype": "markdown",
    "markdown": {
        "content": "Ooops!! The pipeline failed. \n
         >commit id: <font color=\"comment\">[$SHORT_SHA](https://github.com/$repository/commit/$commit)</font>
         >repository: <font color=\"comment\">$repository</font>
         >branch: <font color=\"comment\">$branch</font>
         >person: <font color=\"comment\">$person</font> \n
         \nYou can check it here [failed pipeline](https://github.com/$repository/actions/runs/$action_id)"
    }
}
EOF
}

curl -H "Content-Type: application/json" -X POST -d "$(message_to_send)" $(echo $webhook_url | base64 --decode)